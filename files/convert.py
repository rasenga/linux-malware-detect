import sys
import csv
import pandas
import re
import ast
import os
from pathlib import Path

folder_path = Path("/usr/local/maldetect/sess")

file_name = "session."+sys.argv[1]
csv_path = sys.argv[2]

tool = re.compile('[{=?](.*?)[}=?]')
test1 = re.compile('[}=?](.*)')

full_path = os.path.join(folder_path,file_name)
full_csv_path =(csv_path +'result.csv')
with open(full_csv_path,'w',-1,encoding="utf-8",newline='') as f:
    writer = csv.writer(f)

    with open(full_path, 'r') as reportfile:
        for rows in range(10):
            line = reportfile.readline()
            if rows > 5 and rows < 10:
                line = line.replace(" ","")
                line = line.replace("\n","")
                tmp = line.split(':')
                writer.writerow({tmp[0] : '1'  , tmp[1] : '2' })
        
        i = reportfile.read()
        tools = tool.findall(i)
        malware = test1.findall(i)
        
        for i in range(0, len(malware)-1):
            if tools != "":
                tmp2 = malware[i].split(':') 
                tmp3 = tmp2[1].split(" => ")
                writer.writerow({tools[i] : '1',tmp2[0] : '2',tmp3[0] : '3'})

