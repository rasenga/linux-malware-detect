import sys
import csv
import pandas
import re
import ast
import os
from pathlib import Path


save_path = Path(sys.argv[1])


file_list = sys.argv[2]
mali_file_list = sys.argv[3]
mali_list = []
#tool = re.compile('[{=?](.*?)[}=?]')
test1 = re.compile('[}=?](.*)')

# full_path = os.path.join(folder_path,file_name)
full_csv_path =os.path.join(save_path,'result.csv')

with open(full_csv_path,'w',encoding='UTF-8',newline='') as f:
     writer = csv.writer(f)
     writer.writerow(['File','Label'])
     with open(mali_file_list, 'r') as mallist:
        i = mallist.read()
        #tools = tool.findall(i)
        malware = test1.findall(i)
        
        for i in range(0, len(malware)):
            tmp2 = malware[i].split(' : ') 
            tmp3 = tmp2[1].split(" => ")
            mali_list.append(tmp3[0]) 
     with open(file_list,'r') as fl:
        for i in fl:
            i = i.split('\n')[0]
            if len(mali_list) > 0 and i == mali_list[0] :
                writer.writerow([i,'1'])
                mali_list = mali_list[1:]
            else:
                writer.writerow([i,'0'])



